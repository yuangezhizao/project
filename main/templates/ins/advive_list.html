{% extends "/base.html" %}
{% from 'macros.html' import photo_card, message_part, pagination_widget with context %}

{% block title %}评论列表{% endblock %}

{% block nav %}
    <a class="active item"><i class="comments icon"></i>评论列表</a>
    <a class="item" href="{{ url_for('main.index') }}"><i class="arrow left icon"></i>返回首页</a>
{% endblock %}

{% block content %}
    {% block wide %}
        <div class="sixteen wide column">
    {% endblock %}
    <div class="ui dividing red header">
        <div class="content">
            <h2>评论列表</h2>
        </div>
    </div>
    <table id="advice_list_table" class="tablesorter ui sortable unstackable celled striped red compact table">
        <thead>
        <tr class="positive">
            <th>ID</th>
            <th>筛选条件</th>
            <th>记录数</th>
            <th>评论</th>
            <th>部门</th>
            <th>时间戳</th>
            <th>评论者</th>
            <th>状态</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        {% for advive in advive_list %}
            <tr>
                <td>
                    {{ advive.id }}
                </td>
                <td>
                    <a href="{{ advive.url }}">{{ advive.filter }}</a>
                </td>
                <td>
                    {{ advive.passed_count }}
                </td>
                <td>
                    {{ advive.comments[0].body }}
                </td>
                <td>
                    {{ advive.depart_id }}
                </td>
                <td>
                    {{ moment(advive.timestamp).format('YYYY MMMM Do ，h:mm:ss a') }}
                </td>
                <td>{{ advive.author.name }}
                </td>
                <td>
                    {% if advive.status == 0 %}
                        未回复
                    {% elif advive.status == 1 %}
                        已回复
                    {% elif advive.status == 2 %}
                        新回复
                    {% else %}
                        已完成
                    {% endif %}
                </td>
                <td>
                    {% if advive.status == 0 %}
                        <a class="ui green mini button" href="{{ url_for('ins.show_advive', advive_id=advive.id) }}">首次回复</a>
                    {% elif advive.status == 1 %}
                        <a class="ui blue mini button" href="{{ url_for('ins.show_advive', advive_id=advive.id) }}">等待新回复</a>
                    {% elif advive.status == 2 %}
                        <a class="ui brown mini button" href="{{ url_for('ins.show_advive', advive_id=advive.id) }}">继续回复</a>
                    {% else %}
                        <a class="ui black mini button"
                           href="{{ url_for('ins.show_advive', advive_id=advive.id) }}">已完成</a>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% if advive_list %}
        {{ pagination_widget(pagination, 'ins.advive_list', page=page) }}
    {% endif %}
{% endblock %}

{% block script %}
    {{ super() }}
    <script src="{{ url_for('static', filename='static/js/jquery.tablesorter.combined.min.js') }}"></script>
    <script>
        $(document).ready(function () {
                $("#advice_list_table").tablesorter({sortList: [[0, 0]]});
            }
        );
    </script>
{% endblock %}
